<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Premium</title>
    <style>
        :root{--primary:#D32F2F;--bg:#f4f4f4}
        body{font-family:sans-serif;margin:0;padding:20px;background:var(--bg)}
        h1{color:var(--primary);text-align:center}
        form{display:flex;flex-direction:column;gap:15px;background:#fff;padding:20px;border-radius:5px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
        input,select,textarea{padding:12px;border:1px solid #ccc;border-radius:4px;font-size:16px}
        button{background:var(--primary);color:#fff;padding:15px;border:none;cursor:pointer;font-weight:bold;border-radius:4px}
        button:hover{background:#b71c1c}
        img.thumb{width:60px;height:60px;object-fit:cover;border-radius:4px}
        #status{display:none;padding:10px;text-align:center;font-weight:bold;margin-bottom:10px;border-radius:4px}
        .success{background:#d4edda;color:#155724} .loading{background:#cce5ff;color:#004085}
        table{width:100%;border-collapse:collapse;margin-top:20px;background:#fff}
        th,td{padding:10px;border:1px solid #ddd;text-align:left}
        th{background:#333;color:white}
    </style>
</head>
<body>
    <h1>Painel CFC Premium</h1>
    <div id="status"></div>
    
    <section id="login-section">
        <form id="loginForm">
            <input type="email" id="login-email" placeholder="Email Administrativo">
            <input type="password" id="login-password" placeholder="Senha">
            <button>Entrar no Sistema</button>
        </form>
    </section>

    <section id="admin-panel" style="display:none">
        <form id="product-form">
            <h3>Cadastrar Novo Serviço</h3>
            <input type="hidden" id="productId">
            
            <label>Nome do Serviço:</label>
            <input id="name" placeholder="Ex: Habilitação Carro (B)" required>
            
            <label>Preço (R$):</label>
            <input type="number" id="price" placeholder="0.00" required>
            
            <label>Categoria:</label>
            <select id="secao" required>
                <option value="">Selecione...</option>
                <option value="carro">Carro (Cat. B)</option>
                <option value="moto">Moto (Cat. A)</option>
                <option value="combo">Carro + Moto (AB)</option>
                <option value="onibus">Ônibus (Cat. D)</option>
                <option value="adicao">Adição de Categoria</option>
                <option value="renovacao">Renovação / Reciclagem</option>
            </select>
            
            <label>Descrição (Incluso no pacote):</label>
            <textarea id="description" rows="4" placeholder="Detalhes do serviço..."></textarea>
            
            <label>Destaque:</label>
            <select id="isFeatured">
                <option value="nenhum">Normal</option>
                <option value="destaque">⭐ Oferta Especial</option>
            </select>
            
            <label>Foto do Serviço:</label>
            <input type="file" id="imageUrl">
            
            <button type="submit">Salvar Serviço</button>
            <button type="button" id="cancel-edit-btn" style="display:none;background:#777">Cancelar Edição</button>
        </form>

        <div style="overflow-x:auto">
            <table id="products-table">
                <thead><tr><th>Foto</th><th>Serviço</th><th>Valor</th><th>Ações</th></tr></thead>
                <tbody id="products-list"></tbody>
            </table>
        </div>
        
        <button id="btnLogout" style="margin-top:20px;background:#333">Sair</button>
    </section>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script> 
    <script>
        // CONFIGURAÇÃO CLOUDINARY
        const CLOUDINARY_URL="https://api.cloudinary.com/v1_1/dlsxwrkks/auto/upload"; 
        const UPLOAD_PRESET="da1soqf5";

        // CONFIGURAÇÃO FIREBASE
        const firebaseConfig={apiKey:"AIzaSyAGXoIZh1tPLbpQ62MKw1NkXxboIg5cbMk",authDomain:"auto-escola-premium.firebaseapp.com",projectId:"auto-escola-premium",storageBucket:"auto-escola-premium.firebasestorage.app",messagingSenderId:"100515126742",appId:"1:100515126742:web:88069eb81308bded8e1877"};
        firebase.initializeApp(firebaseConfig); 
        const db=firebase.firestore(); 
        const auth=firebase.auth();
        
        // FUNÇÃO DE UPLOAD
        async function uploadFile(f){
            const fd=new FormData();
            fd.append('file',f);
            fd.append('upload_preset',UPLOAD_PRESET);
            const r=await fetch(CLOUDINARY_URL,{method:'POST',body:fd});
            const d=await r.json();
            return d.secure_url;
        }
        
        document.addEventListener('DOMContentLoaded',()=>{
            const logF=document.getElementById('loginForm'), stat=document.getElementById('status'); let oldImg='';
            
            function showStatus(m,t='loading'){stat.textContent=m;stat.className=t;stat.style.display='block';setTimeout(()=>stat.style.display='none',3000)}
            
            logF.addEventListener('submit',async(e)=>{
                e.preventDefault();
                try{await auth.signInWithEmailAndPassword(document.getElementById('login-email').value,document.getElementById('login-password').value)}
                catch(e){alert("Erro: "+e.message)}
            });
            
            auth.onAuthStateChanged(u=>{
                if(u){document.getElementById('login-section').style.display='none';document.getElementById('admin-panel').style.display='block';fetchP()}
            });
            
            document.getElementById('btnLogout').addEventListener('click',()=>auth.signOut().then(()=>location.reload()));
            
            async function fetchP(){
                const l=document.getElementById('products-list');l.innerHTML='';
                (await db.collection("products").orderBy("createdAt","desc").get()).forEach(d=>{
                    const p=d.data(); 
                    l.innerHTML+=`<tr><td><img src="${p.imageUrl}" class="thumb"></td><td>${p.name}<br><small>${p.secao}</small></td><td>R$ ${p.price}</td><td><button onclick="edit('${d.id}')" style="background:#007bff;padding:5px">Editar</button> <button onclick="del('${d.id}')" style="background:#dc3545;padding:5px">X</button></td></tr>`;
                });
            }

            document.getElementById('product-form').addEventListener('submit',async(e)=>{
                e.preventDefault(); showStatus("Salvando...");
                try{
                    let img=oldImg; 
                    const f=document.getElementById('imageUrl').files[0]; 
                    if(f) img=await uploadFile(f);
                    
                    const d={
                        name:document.getElementById('name').value, 
                        price:parseFloat(document.getElementById('price').value), 
                        secao:document.getElementById('secao').value, 
                        description:document.getElementById('description').value, 
                        isFeatured:document.getElementById('isFeatured').value, 
                        imageUrl:img, 
                        createdAt:firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    const id=document.getElementById('productId').value||`srv_${Date.now()}`;
                    await db.collection("products").doc(id).set(d,{merge:true});
                    
                    document.getElementById('product-form').reset(); document.getElementById('productId').value=''; oldImg=''; 
                    document.getElementById('cancel-edit-btn').style.display='none';
                    fetchP(); showStatus("Sucesso!","success");
                }catch(err){showStatus("Erro: "+err.message,"error")}
            });

            window.edit=async(id)=>{
                const d=await db.collection("products").doc(id).get();const p=d.data();
                document.getElementById('productId').value=id;
                document.getElementById('name').value=p.name;
                document.getElementById('price').value=p.price;
                document.getElementById('secao').value=p.secao;
                document.getElementById('description').value=p.description;
                document.getElementById('isFeatured').value=p.isFeatured;
                oldImg=p.imageUrl;
                document.getElementById('cancel-edit-btn').style.display='inline';
                window.scrollTo(0,0);
            };
            
            document.getElementById('cancel-edit-btn').addEventListener('click',()=>{document.getElementById('product-form').reset();document.getElementById('cancel-edit-btn').style.display='none'});
            window.del=async(id)=>{if(confirm("Tem certeza que quer apagar?"))await db.collection("products").doc(id).delete();fetchP()};
        });
    </script>
</body>
</html>
